<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rental Invoice Form</title>
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const today = new Date().toISOString().substr(0, 10);
      document.getElementById('todayDate').value = today;
    });
  </script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>

<body class="bg-gray-100">
  {% include 'navbar.html'%}

<div class="max-w-5xl mx-auto bg-white p-8 rounded-xl shadow space-y-8">

  <!-- Header -->
  <h2 class="text-2xl font-bold text-blue-700 text-center mb-6">Car Rental  Form</h2>

  <!-- Date & Vehicle Info -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div>
      <label class="block text-sm font-medium text-gray-700">Date</label>
      <input name= "docdate"type="date" id="todayDate" class="w-full border px-4 py-2 rounded" required>
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Vehicle Code</label>
      <select class="w-full border px-4 py-2 rounded" name="Plate_no" required>
        <option>-- Select --</option>
        {% for vehicles in vehicle %}
        <option value="{{ vehicles.Plate_no}}" >{{ vehicles.Ast_code }} - {{ vehicles.Plate_no }}</option>
        {% endfor %}
      </select>
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Car Color</label>
      <input type="text" name="color" class="w-full border px-4 py-2 rounded bg-gray-100 text-gray-600 cursor-not-allowed" placeholder="e.g. Red" required disabled>
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Brand</label>
      <input type="text" name="brand" class="w-full border px-4 py-2 rounded bg-gray-100 text-gray-600 cursor-not-allowed" required>
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Model</label>
      <input type="text" name="model" class="w-full border px-4 py-2 rounded bg-gray-100 text-gray-600 cursor-not-allowed" required>
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Meter Out</label>
      <input type="number" name="meeter" class="w-full border px-4 py-2 rounded bg-gray-100 text-gray-600 cursor-not-allowed" placeholder="e.g. 12234" required>
    </div>
  </div>

  <hr class="my-6 border-t-2 border-gray-300">

<h3 class="text-lg font-semibold text-blue-700 mb-2">Pricing Details</h3>
<div class="grid grid-cols-1 md:grid-cols-4 gap-4">
  <div>
    <label class="block text-sm font-medium text-gray-700">Rent/Day (₹)</label>
    <input type="number" name="Rent" class="w-full border px-4 py-2 rounded" required>
  </div>
  <div>
    <label class="block text-sm font-medium text-gray-700">Allowed Km</label>
    <input type="number" name= "Allowed" class="w-full border px-4 py-2 rounded" required>
  </div>
  <div>
    <label class="block text-sm font-medium text-gray-700">Addl. Km (₹/km)</label>
    <input type="number" class="w-full border px-4 py-2 rounded">
  </div>
  <div>
    <label class="block text-sm font-medium text-gray-700">Late Hr (₹/hr)</label>
    <input type="number" class="w-full border px-4 py-2 rounded">
  </div>
  <div>
    <label class="block text-sm font-medium text-gray-700">No. of Days</label>
    <input type="number" placeholder="e.g. 5" class="w-full border px-4 py-2 rounded">
  </div>
  <div>
    <label class="block text-sm font-medium text-gray-700">Return Date</label>
    <input type="date" class="w-full border px-4 py-2 rounded" name="return_date">
  </div>
</div>

  <hr class="my-6 border-t-2 border-gray-300">

  <!-- Customer Details -->
  <div class="bg-white p-6 rounded-xl shadow-lg">
  <!-- Radio Buttons -->
  <div class="flex space-x-6 mb-6">
    <label class="flex items-center space-x-2">
      <input type="radio" name="customerType" value="existing" checked
        class="text-blue-600 focus:ring-blue-500">
      <span class="text-gray-700 font-medium">Existing</span>
    </label>
    <label class="flex items-center space-x-2">
      <input type="radio" name="customerType" value="new"
        class="text-blue-600 focus:ring-blue-500">
      <span class="text-gray-700 font-medium">New</span>
    </label>
  </div>

  <h3 class="text-lg font-semibold text-blue-700 mb-4">Customer Details</h3>

  <!-- Existing Customer -->
  <div id="existingSection" class="grid grid-cols-1 md:grid-cols-2 gap-4">
    <div>
      <label class="block text-sm font-medium text-gray-700">Customer ID</label>
      <select class="w-full border px-4 py-2 rounded">
        <option>-- Select --</option>
        <option>CUST001</option>
        <option>CUST002</option>
      </select>
    </div>
    <div class="flex items-center justify-center mt-2 md:mt-0">
      <img src="https://via.placeholder.com/100" alt="Customer"
        class="rounded-full shadow border">
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Customer Name</label>
      <input type="text" class="w-full border px-4 py-2 rounded">
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Email</label>
      <input type="email" class="w-full border px-4 py-2 rounded">
    </div>
    <div class="md:col-span-2">
      <label class="block text-sm font-medium text-gray-700">Phone</label>
      <div class="flex space-x-2">
        <input type="tel" class="flex-1 border px-4 py-2 rounded">
        <button id="sendOtpBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
          Send OTP
        </button>
      </div>
      <!-- OTP Input + Verify -->
      <div id="otpSection" class="mt-3 hidden">
        <input id="otpInput" type="text" maxlength="6"
          class="w-full border px-4 py-2 rounded mb-2" placeholder="Enter OTP">
        <button id="verifyBtn"
          class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 w-full">
          Verify
        </button>
      </div>
    </div>
  </div>

  <!-- New Customer -->
  <div id="newSection" class="grid grid-cols-1 md:grid-cols-2 gap-4 hidden">
    <div>
      <label class="block text-sm font-medium text-gray-700">Customer ID</label>
      <input type="text" class="w-full border px-4 py-2 rounded bg-gray-100"
        value="Auto Generated" readonly>
    </div>
    <div class="flex items-center justify-center mt-2 md:mt-0">
      <img src="https://via.placeholder.com/100" alt="Customer"
        class="rounded-full shadow border">
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Customer Name</label>
      <input type="text" class="w-full border px-4 py-2 rounded">
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Email</label>
      <input type="email" class="w-full border px-4 py-2 rounded">
    </div>
    <div class="md:col-span-2">
      <label class="block text-sm font-medium text-gray-700">Phone</label>
      <div class="flex space-x-2">
        <input type="tel" class="flex-1 border px-4 py-2 rounded">
        <button id="sendOtpBtnNew" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
          Send OTP
        </button>
      </div>
      <!-- OTP Input + Verify -->
      <div id="otpSectionNew" class="mt-3 hidden">
        <input id="otpInputNew" type="text" maxlength="6"
          class="w-full border px-4 py-2 rounded mb-2" placeholder="Enter OTP">
        <button id="verifyBtnNew"
          class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 w-full">
          Verify
        </button>
      </div>
    </div>
  </div>
</div>




  <!-- Invoice Details -->
  <h3 class="text-lg font-semibold text-blue-700 mb-2">Invoice Details</h3>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div>
      <label class="block text-sm font-medium text-gray-700">Discount</label>
      <div class="flex gap-2">
        <select class="w-1/2 border px-2 py-2 rounded">
          <option>Flat</option>
          <option>%</option>
        </select>
        <input type="number" class="w-1/2 border px-2 py-2 rounded" placeholder="Amount">
      </div>
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Tax</label>
      <div class="flex gap-2">
        <select class="w-1/2 border px-2 py-2 rounded">
          <option>GST</option>
          <option>CGST</option>
          <option>SGST</option>
        </select>
        <input type="number" class="w-1/2 border px-2 py-2 rounded" placeholder="Amount">
      </div>
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Others</label>
      <div class="flex gap-2">
        <select class="w-1/2 border px-2 py-2 rounded">
          <option>Delivery</option>
          <option>Driver Tip</option>
        </select>
        <input type="number" class="w-1/2 border px-2 py-2 rounded" placeholder="Amount">
      </div>
    </div>
  </div>

  <hr class="my-6 border-t-2 border-gray-300">

  <!-- Payment Details -->
  <h3 class="text-lg font-semibold text-blue-700 mb-2">Payment Details</h3>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div>
      <label class="block text-sm font-medium text-gray-700">Payment Method</label>
      <select class="w-full border px-4 py-2 rounded" required>
        <option>-- Select --</option>
        <option>Cash</option>
        <option>Card</option>
        <option>UPI</option>
        <option>Bank Transfer</option>
      </select>
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Amount Excl. Tax</label>
      <input type="number" class="w-full border px-4 py-2 rounded" required>
    </div>
    <div>
      <label class="block text-sm font-medium text-gray-700">Total Amount Incl. Tax</label>
      <input type="number" class="w-full border px-4 py-2 rounded" required>
    </div>
  </div>

  <!-- Save Button -->
  <div class="pt-6 text-center">
    <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700">
      Save Invoice
    </button>
  </div>

</div>

<script>
  // Toggle Existing/New
  const existingSection = document.getElementById("existingSection");
  const newSection = document.getElementById("newSection");
  document.querySelectorAll("input[name='customerType']").forEach(radio => {
    radio.addEventListener("change", (e) => {
      if (e.target.value === "existing") {
        existingSection.classList.remove("hidden");
        newSection.classList.add("hidden");
      } else {
        newSection.classList.remove("hidden");
        existingSection.classList.add("hidden");
      }
    });
  });

  // OTP Logic (Reusable)
  function setupOtpFlow(sendBtnId, otpSectionId, otpInputId, verifyBtnId) {
    const sendBtn = document.getElementById(sendBtnId);
    const otpSection = document.getElementById(otpSectionId);
    const otpInput = document.getElementById(otpInputId);
    const verifyBtn = document.getElementById(verifyBtnId);

    sendBtn.addEventListener("click", () => {
      otpSection.classList.remove("hidden");
      otpInput.removeAttribute("readonly");
      otpInput.value = "";
      verifyBtn.textContent = "Verify";
      verifyBtn.classList.remove("bg-gray-400");
      verifyBtn.classList.add("bg-green-600", "hover:bg-green-700");
    });

    verifyBtn.addEventListener("click", () => {
      // Simulate OTP check (set correct OTP as 123456 for demo)
      if (otpInput.value === "123456") {
        otpInput.setAttribute("readonly", true);
        verifyBtn.textContent = "Verified ✓";
        verifyBtn.classList.remove("bg-green-600", "hover:bg-green-700");
        verifyBtn.classList.add("bg-gray-400");
      } else {
        alert("Invalid OTP. Try again.");
      }
    });
  }

  // Setup for both sections
  setupOtpFlow("sendOtpBtn", "otpSection", "otpInput", "verifyBtn");
  setupOtpFlow("sendOtpBtnNew", "otpSectionNew", "otpInputNew", "verifyBtnNew");

  document.addEventListener("DOMContentLoaded", function () {
  const plateSelect = document.querySelector("select[name='Plate_no']");
  const colorInput = document.querySelector("input[name='color']");
  const brandInput = document.querySelector("input[name='brand']");
  const modelInput = document.querySelector("input[name='model']");
  const meterInput = document.querySelector("input[name='meeter']");
  const rentInput = document.querySelector("input[name='Rent']");
  const allowedInput = document.querySelector("input[name='Allowed']");

  plateSelect.addEventListener("change", function () {
    const plateNo = this.value;

    if (plateNo) {
      fetch(`get_vehicle/?Plate_no=${encodeURIComponent(plateNo)}`)
        .then(response => response.json())
        .then(data => {
          colorInput.value = data.color || "";
          brandInput.value = data.brand || "";
          modelInput.value = data.model || "";
          meterInput.value = data.meeter || "";
          rentInput.value = data.Rent || "";
          if (allowedInput) {
            allowedInput.value = data.Allowed || "";
          }
        })
        .catch(error => console.error("Error fetching vehicle data:", error));
    } else {
      colorInput.value = "";
      brandInput.value = "";
      modelInput.value = "";
      meterInput.value = "";
      rentInput.value = "";
      if (allowedInput) {
        allowedInput.value = "";
      }
    }
  });
});

document.captureEvents
</script>
